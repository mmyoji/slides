## Intro to ML with Python 6th

2017/12/07 @mmyoji

---

## 目次

* 5.3 評価基準とスコア
* 5.4 まとめと展望

---

## 今まで見てきた評価基準

* クラス分類性能: 精度
* 回帰性能: R^2

**評価基準の1例でしかない**

---

## あるべき評価基準

* **ビジネス評価基準** に沿った評価方法を用いる
    * アプリケーションの高レベルでの目的
* e.g. アプリのインストール数を増やす, 平均記事閲覧数を増やす, etc.

---

ここからは2クラス分類を想定していく〜

---

## 陽性 / 陰性

* 陽性 positive: 探しているもの
* 陰性 negative: 探していないもの
* e.g. ガンの診断
    * 陽性: ガンの疑いがある
    * 陰性: 健康

---

## 偽陽性 / 偽陰性

* 偽陽性 false positive FP
    * 健康な人をガンの疑いがあると診断
* 偽陰性 false negative FN
    * ガンの可能性がある人を健康と診断
* これが「ガン診断アプリ」だった場合、FNは最悪の場合死に至るのでFPよりインパクトが大きい

---

## 真陽性 / 真陰性

* 真陽性 true positive TP
    * 陽性と判断された人のうち実際に陽性
* 真陰性 true negative TN
    * 陰性と判断された人のうち実際に陰性

---

## 偏ったデータ

* 広告のクリック率
    * クリックした: 1%
    * クリックしてない: 99%
* これを評価するML Model の精度は99%になった
* -> 果たして良いのか...???

---

## 混同行列

| TN | FP |
|----|----|
| FN | TP |

ALL = TN + FP + FN + TP

---

## 混同行列 つづき

* (精度) = (TP + TN) / ALL
    * ただしく分類できたものの割合
* (適合率) = TP / (TP + FP)
    * 陽性と予測されたうち、正しいものの割合
* (再現率) = TP / (TP + FN)
    * 実際に陽性のもののうち、正しく予測されたものの割合

---

## 適合率

* precision
* e.g.) 新薬の有効性（臨床試験前）
    * 臨床試験は高コスト
    * 新薬が __実際有効じゃないのに有効__ と判断されるのを避けたい

---

## 再現率

* recall
* e.g.) 先のガン診断の例

---

## 適合率と再現率

* お互いに tradeoff の関係にある
* **f-score** (f-値, f-measure) を用いてまとめて計測
    * テキストでは f1-score
* `sklearn.metrics.classification_report` が便利

---

## 予測の(不)確実性

* `decision_function|predict_proba` を使う
* それぞれ閾値があり、それを超えれば陽性と判定

---

## 適合率-再現率カーブ

* `precision_recall_curve`
* すべての取りうる閾値をグラフにして表現
    * 適合率と再現率の組み合わせ
* グラフの右上が理想
* 複数のアルゴリズム毎に比較したい場合は **平均適合率** を見る

---

## ROCカーブ

* 受信者動作特性カーブ
* 偽陽性率 FPR を 真陽性率 TPR に対してプロット
    * FPR = FP / (FP + TN)
    * 陰性のうち、間違って予測されたもの
* カーブの左上が理想

---

## AUC

* ROCカーブの下の領域
* Area Under the Curve
* ROCカーブを１つの値にまとめることができる
* `roc_auc_score`
* 偏ったデータの場合は特に精度を使うよりこちらを使う

---

## 多クラス分類の場合

* `classification_report` はそのまま使える
* `f-score` は「そのクラスか、それ以外か」という2クラス分類が複数あると考え、すべての平均を取る

---

## 回帰の場合

* ほとんどのケースで R^2 使えばいいよ

---

## AUCの利用

* `GridSearchCV` や `cross_val_score` でも使いたい
* `scoring="roc_auc"` param を使う

---

## まとめ

* アルゴリズムの評価やチューニングのために交差検証、グリッドサーチ、評価基準などを見た
* __検証データ__ と __評価のためのテストデータ__ をちゃんと区別しろ
    * テストデータが「利用済み」になってしまわないように
* 精度を上げることが最終目的であることは少ない
    * アプリケーション（ビジネス）の目標に対して成果を上げられるように

---

おわり
